##
# Install MariaDB with Galera Plugin for clustering
#
---
- name: add self signed key for MariaDB
  become: yes
  apt_key:
    keyserver: hkp://keyserver.ubuntu.com:80
    id: '0xcbcb082a1bb943db'
    state: present
  tags:
    - mariadb

- name: add apt repo for MariaDB
  become: yes
  apt_repository:
    repo: deb [arch=amd64] http://ftp.kaist.ac.kr/mariadb/repo/10.1/ubuntu trusty main
    state: present
  tags:
    - mariadb

- name: install MariaDB
  become: yes
  apt:
    name: '{{ item }}'
    state: latest
    update_cache: yes
  with_items:
    - mariadb-client
    - mariadb-galera-server
    - galera
  tags:
    - mariadb

- name: manual override mysql service init.d script
  become: yes
  copy:
    content: manual
    dest: /etc/init/mysql.override
  tags:
    - mariadb

##
# allow manual control over service behavior,
# must be explicitly started
#
- name: stop mysql service, for
  become: yes
  service:
    name: mysql
    state: stopped
  tags:
    - mariadb
