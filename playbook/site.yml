---
- hosts: all
  roles:
    - common

##
# consul server cluster on all master nodes
# &
# consul agent cluster (joined with the servers)
# on all mesos slave nodes
##
- hosts: consul-server
  roles:
    - { role: 'consul', mode: 'server' }

- hosts: consul-agent
  roles:
    - { role: 'consul', mode: 'agent' }

##
# Install mesos-master and slave on respective nodes
# @NOTE: mesos-slave must be stopped on master and mesos-master on slave
# manually as done below to prevent unncessary master node on every slave
##
- hosts: mesos-master
  roles:
    - { role: 'mesos', mode: 'master' }
  tasks:
    - name: stop mesos-slave
      become: yes
      service:
        name: mesos-slave
        state: stopped
        enabled: no

- hosts: mesos-slave
  roles:
    - { role: 'mesos', mode: 'slave' }
  tasks:
    - name: stop mesos-master and zk services
      become: yes
      service:
        name: '{{ item }}'
        state: stopped
        enabled: no
      with_items:
        - mesos-slave
        - zookeeper
